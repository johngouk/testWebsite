<!DOCTYPE HTML>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
		<style>
			html, body {
				height: 100%;
				padding: 0;
				margin: 0;
			}
			#map {
				/* configure the size of the map */
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<div id="map"></div>
		<script>
			let lon = 0;
			let lat = 0;
			/*
			var geojsonFeature = {
			    "type": "Feature",
			    "properties": {
			        "name": "House of Gouk",
			        "amenity": "Personal Residence",
			        "popupContent": "This is where we live!",
					"show_on_map": true
			    },
			    "geometry": {
			        "type": "Point",
			        "coordinates": [-1.0214561668254005, 51.45974472284773]
			    }
			};
			*/
			/*	NOTE: This doesn't contain NI postcodes - they have to be separately licensed, and are provided in raw form, with Irish 
				easting/northing location data, rather than lon/lat, so would require to be converted.
				https://www.nisra.gov.uk/publications/central-postcode-directory-supporting-documents
				https://www.nisra.gov.uk/files/nisra/documents/2025-03/CPD-Guidance-Jan-2025.pdf
			
				https://api.getthedata.com/postcode/RG30+6AF
				Response of this form:

			{
				"status":"match",
				"match_type":"unit_postcode",
				"input":"RG30 6AF",
				"data":
				{
					"postcode":"RG30 6AF",
					"status":"live","usertype":"small","easting":468139,"northing":173908,
					"positional_quality_indicator":1,
					"country":"England",
					"latitude":"51.460056",
					"longitude":"-1.020616",
					"postcode_no_space":"RG306AF",
					"postcode_fixed_width_seven":"RG306AF",
					"postcode_fixed_width_eight":"RG30 6AF",
					"postcode_area":"RG",
					"postcode_district":"RG30",
					"postcode_sector":"RG30 6",
					"outcode":"RG30",
					"incode":"6AF"
				},
				"copyright":
				[	"Contains OS data (c) Crown copyright and database right 2025",
					"Contains Royal Mail data (c) Royal Mail copyright and database right 2025",
					"Contains National Statistics data (c) Crown copyright and database right 2025"
				]
			}
			Attribution required somehow... ALL of copyright element!
			*/
			function showMap(lon, lat, zoom){
				// initialize Leaflet
				var map = L.map('map').setView({lon: lon, lat: lat}, zoom);

				// add the OpenStreetMap tiles
				L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
					maxZoom: 19,
					attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
				}).addTo(map);

				// show the scale bar on the lower left corner
				L.control.scale({imperial: true, metric: true}).addTo(map);

				// show a marker on the map
				L.marker({lon: lon, lat: lat}).bindPopup('Lon:' + lon.toFixed(2) + ' Lat:' + lat.toFixed(2)).addTo(map);	
				
				// Add a Geo feature
				//L.geoJSON(geojsonFeature).addTo(map);
			}
			
			function success(position){
				lon = position.coords.longitude;
				lat = position.coords.latitude;
				//alert('Lon:' + lon + 'Lat:' + lat);
				showMap(lon, lat, 17);
			}
			function error(){
				alert('Unable to retrieve your position');
				showMap(0,0,2)
			}

			async function getLonLatFromPostCode(postcode) {
			  let myObject = await fetch("https://api.getthedata.com/postcode/" + postcode);
			  let myText = await myObject.text();
			  let myData = JSON.parse(myText);
			  return [myData["data"]["longitude"], myData["data"]["latitude"]];
			}

			postcode = "RG30+6AF";
			getLonLatFromPostCode(postcode).then(
				function(value) {showMap(parseFloat(value[0]), parseFloat(value[1]), 17);}
			);
			
			/*
			if ("geolocation" in navigator) {
				// geolocation is available 
				navigator.geolocation.getCurrentPosition(success, error);
			} else {
				// geolocation IS NOT available 
				alert('GeoLocation is not available');
			}
			*/
		</script>
	</body>
</html>